/*!
 * @maptalks/gltf-layer v0.2.0
 * LICENSE : UNLICENSED
 * (c) 2016-2020 maptalks.org
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@maptalks/gl"),require("maptalks")):"function"==typeof define&&define.amd?define(["exports","@maptalks/gl","maptalks"],t):t((e=e||self).maptalks=e.maptalks||{},e.maptalksgl,e.maptalks)}(this,function(e,l,c){"use strict";function o(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}function a(e){return null==e}function h(e){return!a(e)}function i(e){var t;for(t in e)return!1;return!0}function u(e,t){var n=new Set(t);return Array.from(new Set(e.filter(function(e){return n.has(e)})))}for(var w=[],t=0;t<6;t++)w[t]=[];var T=[];function f(e,t,n){var i,s,r,a,o,h,u,l,c,f,d,p,m,v,g,y,k,S,A;s=(i=e)[0],r=i[1],a=i[2],o=i[3],h=i[4],u=i[5],l=i[6],c=i[7],f=i[8],d=i[9],p=i[10],m=i[11],v=i[12],g=i[13],y=i[14],k=i[15],q(w[0],o-s,c-h,m-f,k-v),q(w[1],o+s,c+h,m+f,k+v),q(w[2],o+r,c+u,m+d,k+g),q(w[3],o-r,c-u,m-d,k-g),q(w[4],o-a,c-l,m-p,k-y),q(w[5],o+a,c+l,m+p,k+y);for(var b=0;b<6;b++)if(!n||"0"!==n.charAt(b)){var M=w[b];if(T[0]=0<M[0]?t[1][0]:t[0][0],T[1]=0<M[1]?t[1][1]:t[0][1],T[2]=0<M[2]?t[1][2]:t[0][2],A=T,(S=M)[0]*A[0]+S[1]*A[1]+S[2]*A[2]+S[3]<0)return!1}return!0}var r=1/6;function q(e,t,n,i,s){return e[0]=t*r,e[1]=n*r,e[2]=i*r,e[3]=s*r,e}var d={},p=0,m={lightAmbient:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],lightDirection:[1,1,1]},v=[.2107,-.0202],n=function(n){function e(e){var t;return(t=n.call(this,e)||this).gltfScenes={},t.e={},t.t={},t.n=[],t.i(),t}o(e,n);var t=e.prototype;return t.draw=function(e,t){p=e,this.prepareCanvas(),this.s(t)},t.drawOnInteracting=function(e,t,n){p=t,this.s(n)},t.needToRedraw=function(){var e=this.layer.r();for(var t in e){if(e[t].isDirty())return!0}return n.prototype.needToRedraw.call(this)},t.hitDetect=function(){return!1},t.createContext=function(){var e=this.canvas.gl&&this.canvas.gl.wrap;if(e)this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl;else{var t=this.layer.options.glOptions||{alpha:!0,depth:!0,stencil:!0};this.glOptions=t,this.gl=this.gl||this.a(this.canvas,t),this.regl=l.createREGL({gl:this.gl,extensions:["ANGLE_instanced_arrays","OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","EXT_shader_texture_lod","OES_element_index_uint","OES_standard_derivatives","WEBGL_depth_texture"],optionalExtensions:this.layer.options.glExtensions||[]})}e&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.o(),this.layer.fire("contextcreate",{context:this.gl,regl:this.regl})},t.o=function(){var e=this.layer.getMap(),t=new l.reshader.Renderer(this.regl);this.renderer=t,this.h={projMatrix:e.projMatrix,projViewMatrix:e.projViewMatrix,viewMatrix:e.viewMatrix,uCameraPosition:e.cameraPosition,cameraPosition:e.cameraPosition},this.u=new l.reshader.FBORayPicking(t,{vert:"\n        attribute vec3 aPosition;\n        uniform mat4 projViewMatrix;\n        uniform mat4 modelMatrix;\n        uniform mat4 positionMatrix;\n        //引入fbo picking的vert相关函数\n        #include <fbo_picking_vert>\n        #include <get_output>\n        void main()\n        {\n            mat4 localPositionMatrix = getPositionMatrix();\n            gl_Position = projViewMatrix * modelMatrix * localPositionMatrix * getPosition(aPosition);\n            //传入gl_Position的depth值\n            fbo_picking_setData(gl_Position.w, true);\n        }",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,t){return l.mat4.multiply([],t.projViewMatrix,t.modelMatrix)}},"projViewMatrix","uPickingId","positionMatrix"]},this.pickingFBO),this.l=new l.reshader.OutlinePass(t,this.viewport)},t.i=function(){var e=d;for(var t in e){var n=e[t];this.c(n.name,n.type,n.config)}},t.f=function(e){var t=e.getShader(),n=this.e[e.getUrl()];"wireframe"===t&&n&&n.geometries.forEach(function(e){e.geometry.buildUniqueVertex(),e.geometry.data.aBarycentric||e.geometry.createBarycentric("aBarycentric")})},t.c=function(e,t,n){var i=this;this.viewport={x:0,y:0,width:function(){return i.canvas?i.canvas.width:1},height:function(){return i.canvas?i.canvas.height:1}},n.extraCommandProps||(n.extraCommandProps={});var s=c.Util.extend({},n);s.uniforms=c.Util.extend([],n.uniforms),s.extraCommandProps=c.Util.extend({},n.extraCommandProps),s.extraCommandProps.viewport=this.viewport,-1<t.indexOf(".")?(t=t.split("."),this.t[e]={shader:new l.reshader[t[0]][t[1]](s)}):this.t[e]={shader:new l.reshader[t](s),type:t},this.shaderListTest=this.t},t.clearCanvas=function(){this.canvas&&(this.regl.clear({color:[0,0,0,0],depth:1,stencil:0}),n.prototype.clearCanvas.call(this))},t.resizeCanvas=function(e){n.prototype.resizeCanvas.call(this,e),this.pickingFBO&&this.pickingFBO.resize(this.canvas.width,this.canvas.height)},t.s=function(o){var h=this,u=0;if(!i(this.gltfScenes)){this.n.splice(0,this.n.length);var e=function(t){var e=h.layer.getGeometries().filter(function(e){return e.isVisible()&&e.getShader()===t});if(!e.length)return"continue";h.d(e);var n=h.p(e);if(!n)return"continue";var i=h.t[t].shader,s=n.getMeshes();n.sortMeshes(h.h.uCameraPosition),h.h.uGlobalTexSize=h.h.globalTexSize=[h.canvas.width,h.canvas.height];var r=null,a={};o?(i.dispose(),i=h.m(o,i,h.t[t].type),h.h.uHalton=h.h.halton=o.jitter||[0,0],i.filter=o.sceneFilter,r=o.renderTarget&&o.renderTarget.fbo,a=h.g(o,a)):h.h.uHalton=h.h.halton=v,c.Util.extend(a,h.h),h.renderer.render(i,a,n,r),h.l.render(h.getOutlineMeshes(),r,{projViewMatrix:a.projViewMatrix,lineColor:[1,0,0]}),h.k(s),u++};for(var t in this.t)e(t);this.S=!0,this.layer.fire("rendercomplete-debug",{count:u}),this.completeRender()}},t.m=function(e,t,n){var i={vert:t.vert,frag:t.frag,uniforms:t.uniforms,extraCommandProps:t.extraCommandProps},s=c.Util.extend({},t.shaderDefines);for(var r in e.includes)e[r].defines&&c.Util.extend(s,s,e[r].defines);return i.defines=s,new l.reshader[n](i)},t.g=function(e,t){if(e.viewshed)for(var n in e.viewshed.renderUniforms)t[n]=e.viewshed.renderUniforms[n];if(e.floodAnalysis)for(var i in e.floodAnalysis.renderUniforms)t[i]=e.floodAnalysis.renderUniforms[i];return t},t.getShadowMeshes=function(){var e=[];if(!this.layer)return e;for(var t=this.layer.getGeometries(),n=0;n<t.length;n++)if(t[n].isCastShadow()){var i=t[n].A();this.gltfScenes[i]&&(e=e.concat(this.gltfScenes[i].modelMeshes))}return e},t.getAnalysisMeshes=function(){return this.n},t.getOutlineMeshes=function(){var e=[];if(!this.layer)return e;for(var t=this.layer.getGeometries(),n=0;n<t.length;n++)if(t[n].isOutline()&&t[n].b()){var i=t[n].A();this.gltfScenes[i]&&(e=e.concat(this.gltfScenes[i].modelMeshes))}return e},t.k=function(e){for(var t=0;t<e.length;t++)this.n.push(e[t])},t.d=function(e){var n=this;e.forEach(function(e){var t=e.A();n.gltfScenes[t]&&(n.M(t),e.isAnimated()||e.hasFunctionDefinition()||e.isOutline()?e.setDirty(!0):e.setDirty(!1))})},t.p=function(e){for(var t=[],n=this.layer.getMap(),i=0;i<e.length;i++){var s=e[i],r=this.gltfScenes[s.A()];if(r)for(var a=r.modelMeshes,o=0;o<a.length;o++){var h=a[o];this.w(h,s),h.setUniform("uPickingId",s.A()),h instanceof l.reshader.InstancedMesh?t.push(h):f(n.projViewMatrix,h.getBoundingBox())&&t.push(h)}}return t.length?new l.reshader.Scene(t):null},t.T=function(e,t,n){var i=e.geometry;"wireframe"!==n||i.data.aBarycentric||(i.buildUniqueVertex(),i.createBarycentric("aBarycentric"));var s=this.q(t,e),r=s.getDefines();return s instanceof l.reshader.InstancedMesh?(r.HAS_PICKING_ID=1,r.HAS_INSTANCE_COLOR=1):r.HAS_PICKING_ID=2,s.setDefines(r),s},t.q=function(e,t){var n=this,i=t.geometry,s=this.layer.r()[e],r=s.getType(),a=null,o=this.z(s,t.materialInfo);if("groupgltfmarker"===r){s.O();var h=s._(l.mat4.identity([])),u=s.getCount();a=new l.reshader.InstancedMesh(h,u,i,o),this.regl?a.generateInstancedBuffers(this.regl):this.layer.on("contextcreate",function(){a.generateInstancedBuffers(n.regl)})}else a=new l.reshader.Mesh(i,o);return s.isTransparent&&s.isTransparent()&&(a.transparent=!0),a.nodeMatrix=t.nodeMatrix,s.isBloom()&&a.setUniform("bloom",!0),a},t.z=function(e,t){var n=null,i=e.getShader(),s=e.getUniforms()||{};if("phong"===i)if("pbrSpecularGlossiness"===t.name)n=new l.reshader.PhongSpecularGlossinessMaterial(t);else{for(var r in m)s[r]=s[r]||m[r];n=new l.reshader.PhongMaterial(t)}else n="wireframe"===i?new l.reshader.WireFrameMaterial(t):"pbr"===i?"pbrSpecularGlossiness"===t.name?new l.reshader.pbr.PBRSpecularGlossinessMaterial(t):new l.reshader.pbr.StandardMaterial(t):new l.reshader.Material(t);for(var a in s)n.set(a,s[a]);return n},t.w=function(e,t){"effectmarker"===t.getType()?t.updateUV(p):"glowmarker"===t.getType()&&t.L();var n=t.getUniforms();if(n)for(var i in n)e.material.set(i,n[i])},t.C=function(e){var n=this,i=e.A(),t=e.getUrl(),s=[],r=e.getShader(),a=this.e[t];if(a)a.geometries.forEach(function(e){var t=n.T(e,i,r);s.push(t)}),a.count+=1;else{var o=e.P();this.e[t]={pickingId:i,json:o,geometries:[],count:1},s=this.R(o,i,t,r)}e.gltfPack=this.e[t].gltfPack,e.I(this.e[t].json),this.gltfScenes[i]={pickingId:i,modelMeshes:s},e.setDirty(!0),this.setToRedraw()},t.R=function(e,n,i,s){var r=this,a=[],t=l.reshader.GLTFHelper.exportGLTFPack(e,this.regl),o=t.getMeshesInfo();return this.e[i].gltfPack=t,o.forEach(function(e){var t=r.T(e,n,s);r.e[i].geometries.push(e),a.push(t)}),a},t.N=function(e,t){for(var n in t)e.setUniform(n,t[n]);return e},t.M=function(e){var t=this,n=this.gltfScenes[e];if(n){var i=this.layer.r(),s=i[e],r=i[e].getUrl();if(this.e[r])if(this.e[r].json){s.B();var a=s.isAnimated();a&&s.gltfPack&&this.j(s)&&s.gltfPack.updateAnimation(p,s.isLooped(),s.getAnimationSpeed());var o=n.modelMeshes,h=s.getModelMatrix();o.forEach(function(e){e instanceof l.reshader.InstancedMesh?(l.mat4.multiply(e.positionMatrix,h,e.nodeMatrix),t.F(e,s)):l.mat4.multiply(e.localTransform,h,e.nodeMatrix),a?e.material.set("skinAnimation",1):e.material.set("skinAnimation",0)})}}},t.F=function(e,t){var n=t._();for(var i in n)e.updateInstancedData(i,n[i]),e.updateBoundingBox(),e.generateInstancedBuffers(this.regl),e.instanceCount=t.getCount()},t.D=function(e){h(e)&&(this.J(e),delete this.gltfScenes[e],this.setToRedraw())},t.G=function(){for(var e in this.gltfScenes){this.J(e);var t=this.layer.r()[e].gltfPack;t&&t.dispose()}this.gltfScenes={},this.setToRedraw()},t.J=function(e){var t=this;if(this.gltfScenes[e]){var n=this.layer.r()[e].getUrl();this.e[n].count-=1,this.gltfScenes[e].modelMeshes.forEach(function(e){t.e[n].count<=0&&e.geometry.dispose(),e.material&&e.material.dispose(),e.dispose()})}},t.V=function(e){this.e&&this.e[e]&&(this.e[e].count-=1,this.e[e].count<=0&&(this.e[e].geometries.forEach(function(e){e.geometry.dispose()}),delete this.e[e]))},t.a=function(e,t){for(var n=["webgl","experimental-webgl"],i=null,s=0;s<n.length;++s){try{i=e.getContext(n[s],t)}catch(e){}if(i)break}return i},t.W=function(e,t,n){if(void 0===n&&(n={}),!this.u)return null;var i=this.layer.getMap();if(this.S){if(!this.n||0===this.n.length)return null;var s=this.n;this.u.render(s,this.h,!0),this.S=!1}var r=this.u.pick(e,t,n.tolerance||3,{projViewMatrix:i.projViewMatrix},{viewMatrix:i.viewMatrix,projMatrix:i.projMatrix,returnPoint:!0}),a=r.meshId,o=r.pickingId,h=r.point,u=this.$(o);return{meshId:a,target:this.layer.r()[u],pickingId:o,point:h}},t.$=function(e){if(!h(e))return null;if(this.layer.r()[e])return e;for(var t=Object.keys(this.layer.r()).sort().map(function(e){return Number(e)}),n=t.length,i=0,s=n-1,r=Math.floor((i+s)/2);i<=n-1&&0<=s;){if(i===s)return t[i];if(t[r]<=e&&e<t[r+1])return t[r];e<t[r]?(s=r-1,r=Math.floor((i+s)/2)):t[r+1]<e&&(i=r+1,r=Math.floor((i+s)/2))}return null},t.j=function(e){return"effectmarker"!==e.getType()&&"glowmarker"!==e.getType()},e}(c.renderer.OverlayLayerCanvasRenderer);function g(i,e){var t,n,s;if(z(i)){var r,a=i.stops&&"object"==typeof i.stops[0][0],o=a||void 0!==i.property,h=a||!o,u=i.type||e||"exponential";if("exponential"===u)r=S;else if("interval"===u)r=k;else if("categorical"===u)r=y;else{if("identity"!==u)throw new Error('Unknown function type "'+u+'"');r=A}if(a){for(var l={},c=[],f=0;f<i.stops.length;f++){var d=i.stops[f];void 0===l[d[0].zoom]&&(l[d[0].zoom]={zoom:d[0].zoom,type:i.type,property:i.property,default:i.default,stops:[]}),l[d[0].zoom].stops.push([d[0].value,d[1]])}for(var p in l)c.push([l[p].zoom,g(l[p])]);s=n=!(t=function(e,t){var n=S({stops:c,base:i.base},e)(e,t);return"function"==typeof n?n(e,t):n})}else s=h?(t=function(e){var t=r(i,e);return"function"==typeof t?t(e):t},!(n=!0)):!(n=!(t=function(e,t){var n=r(i,t?t[i.property]:null);return"function"==typeof n?n(e,t):n}))}else t=function(){return i},s=n=!0;return t.isZoomConstant=s,t.isFeatureConstant=n,t}function y(e,t){for(var n=0;n<e.stops.length;n++)if(t===e.stops[n][0])return e.stops[n][1];return e.default}function k(e,t){for(var n=0;n<e.stops.length&&!(t<e.stops[n][0]);n++);return e.stops[Math.max(n-1,0)][1]}function S(e,t){for(var n=void 0!==e.base?e.base:1,i=0;!(i>=e.stops.length||t<=e.stops[i][0]);)i++;return 0===i?e.stops[i][1]:i===e.stops.length?e.stops[i-1][1]:function n(i,s,r,a,o,h){return"function"==typeof o?function(){var e=o.apply(void 0,arguments),t=h.apply(void 0,arguments);return n(i,s,r,a,e,t)}:o.length?M(i,s,r,a,o,h):b(i,s,r,a,o,h)}(t,n,e.stops[i-1][0],e.stops[i][0],e.stops[i-1][1],e.stops[i][1])}function A(e,t){return n=t,i=e.default,void 0!==n?n:void 0!==i?i:void 0!==s?s:null;var n,i,s}function b(e,t,n,i,s,r){var a,o=i-n,h=e-n;return s*(1-(a=1===t?h/o:(Math.pow(t,h)-1)/(Math.pow(t,o)-1)))+r*a}function M(e,t,n,i,s,r){for(var a=[],o=0;o<s.length;o++)a[o]=b(e,t,n,i,s[o],r[o]);return a}function z(e){return e&&"object"==typeof e&&(e.stops||e.property&&"identity"===e.type)}function s(e){for(var t in e)if(z(e[t]))return!0;return!1}function O(e){return function(e,t){if(!z(e))return function(){return e};e=JSON.parse(JSON.stringify(e));for(var n=!0,i=!0,s=e.stops,r=0;r<s.length;r++)if(z(s[r][1])){var a=g(s[r][1],t);n=n&&a.isZoomConstant,i=i&&a.isFeatureConstant,s[r]=[s[r][0],a]}var o=g(e,t);return o.isZoomConstant=n&&o.isZoomConstant,o.isFeatureConstant=i&&o.isFeatureConstant,o}(e,"exponential")}var x=[],_=function(r){function t(e,t){var n,i=c.Util.extend({},t),s=i.symbol;return delete i.symbol,(n=r.call(this,e,i)||this).U=!1,n.X=l.mat4.identity([]),n.Z="gltfmarker",n.H=!0,n.K={get translation(){return[0,0,0]},get rotation(){return[0,0,0]},get scale(){return[1,1,1]}},n.Q(s),n.B(),n}o(t,r),t.fromJSON=function(e){return new t(e.coordinates,e.options)};var e=t.prototype;return e.Y=function(){var t=this,e=this.getUrl();return l.reshader.GLTFHelper.load(e).then(function(e){return t.I(e),e})},e.Q=function(e){e?(e.translation=e.translation||this.K.translation,e.rotation=e.rotation||this.K.rotation,e.scale=e.scale||this.K.scale,this.setSymbol(e)):(this.options.symbol={},this.ee={})},e.P=function(){return this.te},e.I=function(e){this.te=e},e.ne=function(e,t){this.options.symbol=this.options.symbol||{},this.options.symbol[e]=t},e.ie=function(e,t){this.ee=this.ee||{},this.ee[e]=t},e.getMap=function(){return this.se?this.se.getMap():null},e.setUrl=function(e){var t=this,n=this.getUrl();return this.ne("url",e),this.se&&this.se.re(this).then(function(){t.se.ae(n),t.fire("setUrl-debug")}),this.H=!0,this},e.getUrl=function(){var e=this.oe();return e&&e.url||"cube"},e.addTo=function(e){if(this.se)throw new Error("GLTFMarker cannot be added to two or more layers at the same time.");return this.he(),e.addMarker(this),this},e.remove=function(){this.se&&(this.se.ue(this),r.prototype.remove.call(this))},e.show=function(){return this.options.visible=!0,this.H=!0,this},e.hide=function(){this.options.visible=!1,this.H=!0},e.setBloom=function(e){return this.options.symbol.bloom=e,this},e.isBloom=function(){return this.options.symbol.bloom},e.setCastShadow=function(e){return this.options.shadow=e,this},e.isCastShadow=function(){return this.options.shadow},e.setOutline=function(e){return this.options.outline=e,this.he(),this.setDirty(e),this},e.isOutline=function(){return this.options.outline},e.he=function(){this.options.outline?this.on("mousemove mouseenter mouseleave mouseout"):this.off("mousemove mouseenter mouseleave mouseout")},e.le=function(e){this.ce=e},e.b=function(){return this.ce},e.isVisible=function(){return this.options.visible},e.setCoordinates=function(e){return r.prototype.setCoordinates.call(this,e),this.K&&this.B(),this.H=!0,this},e.copy=function(){var e=this.toJSON();return t.fromJSON(e)},e.setId=function(e){this.options.id=e},e.getId=function(){return this.options.id},e.setShader=function(e){return this.options.symbol.shader=e,this.se&&this.se.f(this),this.H=!0,this},e.getShader=function(){var e=this.oe();return e&&e.shader||"phong"},e.setUniforms=function(e){return this.options.symbol.uniforms=c.Util.extend({},e),this.H=!0,this},e.getUniforms=function(){var e=this.oe();return e&&e.uniforms},e.setUniform=function(e,t){var n=this.options.symbol;return n.uniforms||(n.uniforms={}),n.uniforms[e]=t,this.H=!0,this},e.getUniform=function(e){var t=this.oe();return t&&t.uniforms&&t.uniforms[e]},e.isAnimated=function(){var e=this.oe();return e&&e.animation&&this.te&&this.te.animations},e.setAnimation=function(e){return this.options.symbol.animation=e,this.H=!0,this},e.setAnimationloop=function(e){return this.options.symbol.loop=e,this},e.isLooped=function(){return this.options.symbol.loop},e.getAnimationSpeed=function(){var e=this.oe();return e&&e.speed||1},e.setAnimationSpeed=function(e){return this.options.symbol.speed=e,this.H=!0,this},e.fe=function(e){var t=this.getMap();return t?function(e,t,n){if(void 0===n&&(n=0),!(e&&t instanceof c.Coordinate))return null;var i=e.coordinateToPoint(t,e.getGLZoom());return[i.x,i.y,n]}(t,e||this.getCoordinates()):null},e.setTranslation=function(e){return this.options.symbol.translation=e||this.K.translation,this.H=!0,this.B(),this},e.getTranslation=function(){var e=this.oe();return e&&e.translation||this.K.translation},e.de=function(){var e=this.getTranslation(),t=this.fe();return t?l.vec3.add(this.K.translation,e,t):e},e.setRotation=function(e,t,n){return this.options.symbol.rotation=[e,t,n],this.H=!0,this.B(),this},e.getRotation=function(){var e=this.oe();return e&&e.rotation||this.K.rotation},e.setScale=function(e){return this.options.symbol.scale=e||this.K.scale,this.H=!0,this.B(),this},e.getScale=function(){var e=this.oe();return e&&e.scale||this.K.scale},e.setSymbol=function(e){return this.pe(e),this.options.symbol=this.me(e),this.H=!0,this.ve(),this},e.getSymbol=function(){return this.options.symbol},e.ge=function(e){return this.ee=this.me(e),this.H=!0,this.ve(),this},e.oe=function(){var e=null;return i(this.options.symbol)?i(this.ee)||(e=this.ee):e=this.options.symbol,e},e.ye=function(e){var t=this;return function e(t,n){if(!t)return null;var i=!1;if(Array.isArray(t)){for(var s,r=[],a=0;a<t.length;a++)(s=e(t[a],n))?(r.push(s),i=!0):r.push(t[a]);return i?r:t}var o,h={__fn_types_loaded:!0},u=[];for(o in t)t.hasOwnProperty(o)&&u.push(o);for(var l=function(t){Object.defineProperty(h,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=O(this["_"+t])),this["__fn_"+t].apply(this,n())},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})},c=0,f=u.length;c<f;c++)z(t[o=u[c]])?(i=!0,h["_"+o]=t[o],l(o)):h[o]=t[o];return i?h:t}(e,function(){var e=t.getMap();return e?[e.getZoom()]:null})},e.me=function(e){var t=JSON.parse(JSON.stringify(e)),n=this.ye(t);return n&&n.uniforms&&(n.uniforms=this.ye(e.uniforms)),delete this.ke,n},e.hasFunctionDefinition=function(){if(h(this.ke))return this.ke;var e=this.oe();return this.ke=s(e)||e&&e.uniforms&&s(e.uniforms),this.ke},e.ve=function(){r.prototype.onSymbolChanged.call(this),this.K&&this.B(),this.se&&this.se.f(this)},e.updateSymbol=function(e){var t=this.me(e);for(var n in this.pe(t),t)this.ne(n,t[n]);this.ve()},e.pe=function(e){var t=this.getUrl(),n=e.url;n&&n!==t&&this.setUrl(n)},e.setModelMatrix=function(e){return this.X=e,this},e.getModelMatrix=function(){return this.X},e.B=function(){var e=this.getRotation(),t=3===e.length?l.quat.fromEuler(x,e[0]||0,e[1]||0,e[2]||0):e;this.X=l.mat4.fromRotationTranslationScale(this.X,t,this.de(),this.getScale())},e.setProperties=function(e){return this.options.properties=e,this},e.getProperties=function(){return this.options.properties},e.isDirty=function(){return this.H},e.setDirty=function(e){return this.H=e,this},e.on=function(e,t,n){r.prototype.on.call(this,e,t,n||this),this.se&&this.se.Se(e)},e.off=function(e,t,n){r.prototype.off.call(this,e,t,n||this),this.se&&this.se.Ae()},e.toJSON=function(){return JSON.parse(JSON.stringify({coordinates:this.getCoordinates(),options:this.options}))},e.be=function(e){this.U=e},e.isLoaded=function(){return this.U},e.getType=function(){return this.Z},e.Me=function(e){this.we=e},e.A=function(){return this.we},e.getCount=function(){return 1},t}(c.Marker);_.mergeOptions({visible:!0}),_.registerJSONType("GLTFMarker");var L=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function C(e){if(!e)return"true";var t=e[0];return e.length<=1?"any"===t?"false":"true":"("+("=="===t?P(e[1],e[2],"===",!1):"!="===t?P(e[1],e[2],"!==",!1):"<"===t||">"===t||"<="===t||">="===t?P(e[1],e[2],t,!0):"any"===t?R(e.slice(1),"||"):"all"===t?R(e.slice(1),"&&"):"none"===t?B(R(e.slice(1),"||")):"in"===t?I(e[1],e.slice(2)):"!in"===t?B(I(e[1],e.slice(2))):"has"===t?N(e[1]):"!has"===t?B(N(e[1])):"true")+")"}function E(e){return"$"===e[0]?"f."+e.substring(1):"p["+JSON.stringify(e)+"]"}function P(e,t,n,i){var s=E(e),r="$type"===e?L.indexOf(t):JSON.stringify(t);return(i?"typeof "+s+"=== typeof "+r+"&&":"")+s+n+r}function R(e,t){return e.map(C).join(t)}function I(e,t){"$type"===e&&(t=t.map(function(e){return L.indexOf(e)}));var n=JSON.stringify(t.sort(j)),i=E(e);return t.length<=200?n+".indexOf("+i+") !== -1":"function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }("+i+", "+n+",0,"+(t.length-1)+")"}function N(e){return"$id"===e?'"id" in f':JSON.stringify(e)+" in p"}function B(e){return"!("+e+")"}function j(e,t){return e<t?-1:t<e?1:0}function F(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)e[i]=n[i]}return e}var D=["Point","Polygon","LineString","MultiPoint","MultiPolygon","MultiLineString","GeometryCollection","Feature","FeatureCollection"].reduce(function(e,t){return e[t]=!0,e},{}),J={toGeometry:function(e){if(c.Util.isString(e)&&(e=c.Util.parseJSON(e)),Array.isArray(e)){for(var t=[],n=0,i=e.length;n<i;n++){var s=J.Te(e[n]);Array.isArray(s)?c.Util.pushIn(t,s):t.push(s)}return t}return J.Te(e)},Te:function(e){if(!e||c.Util.isNil(e.type))return null;var t=e.type;if("Feature"===t){var n=e.geometry,i=J.Te(n);return i?(i.setId(e.id),i.setProperties(e.properties),i):null}if("FeatureCollection"===t){var s=e.features;return s?J.toGeometry(s):null}if("Point"===t)return new _(e.coordinates);if("GeometryCollection"!==t)throw new Error("geometry's type is invalid, only support type of Point");for(var r=e.geometries,a=[],o=r.length,h=0;h<o;h++)a.push(J.Te(r[h]));return a},isGeoJSON:function(e){return!(!e||"object"!=typeof e)&&(!!e.type&&(!!D[e.type]&&!(e instanceof _)))}},G=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],V=[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],W=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],$=[-1,0,-1,1,0,-1,-1,0,1,1,0,1],U=[0,1,0,0,1,0,0,1,0,0,1,0],X=[3,1,0,0,2,3],Z=[0,0,1,0,0,1,1,1];function H(e){return"cube"===e?{scenes:[{nodes:[{mesh:0,meshes:[{primitives:[{attributes:{POSITION:{array:new Int8Array(G)},NORMAL:{array:new Int8Array(V)}},indices:new Uint16Array(W),mode:4}]}]}]}]}:"plane"===e?{scenes:[{nodes:[{mesh:0,meshes:[{primitives:[{attributes:{POSITION:{array:new Int8Array($)},NORMAL:{array:new Int8Array(U)},TEXCOORD_0:{array:new Int8Array(Z)}},indices:new Uint16Array(X),mode:4}]}]}]}]}:null}var K=["mousedown","mouseup","mousemove","click","dbclick","touchstart","touchmove","touchend"],Q=function(i){function e(e,t){var n;return(n=i.call(this,e,null,t)||this).pickingId=0,n.qe={},n.requests={},n.ze={},n.Oe={},n.mapEvents="",t&&t.data&&n.addMarker(t.data),n}o(e,i);var t=e.prototype;return t.addMarker=function(e){var t=this;if(J.isGeoJSON(e))this.addMarker(J.toGeometry(e));else if(Array.isArray(e))e.forEach(function(e){t.addMarker(e)});else{var n=e;if(!this.xe(n))return;this.addGeometry(n),n.Me(this.pickingId),((this.qe[this.pickingId]=n).se=this).Se(n.getListeningEvents());var i=n.getId();i&&(this.Oe[i]=n),this._e(n),n.fire("add",{type:"add",target:n,layer:this}),"groupgltfmarker"===n.getType()?this.pickingId+=n.getCount():this.pickingId++}},t.getModels=function(){return this.ze.cube=H("cube"),this.ze.plane=H("plane"),this.ze},t.toJSON=function(e){e||(e={});var t={type:this.getJSONType(),id:this.getId(),options:this.config()};if((a(e.style)||e.style)&&(t.style=this.getStyle()),a(e.geometries)||e.geometries){for(var n=[],i=this.getGeometries(),s=0;s<i.length;s++){var r=i[s].toJSON();n.push(r)}t.geometries=n}return t},t.xe=function(e){return-1<this.options.marekrTypes.indexOf(e.getType())},t._e=function(e){var t=e.getUrl();"cube"===t||"plane"===t?this.Le(e):this.re(e)},t.re=function(e){var t=this;return this.getRenderer()?this.Ce(e):(this.on("renderercreate",function(){t.Ce(e)}),null)},t.Ce=function(n){var i=this,s=n.getUrl(),r=this.getRenderer();return this.requests[s]||(this.requests[s]=n.Y(),this.requests[s].count=0),this.requests[s].then(function(e){if(i.qe[n.A()]&&i.requests[s]){var t=n.P();t||n.I(e),i.ze[s]=e,r.C(n),r.f(n),i.requests[s].count+=1,i.requests[s].complete=!0,n.be(!0),n.fire("load",{data:t}),i.Ee()&&i.fire("modelload",{models:i.getModels()})}})},t.Pe=function(){for(var e in this.requests)if(!this.requests[e].complete)return!1;return!0},t.Ee=function(){for(var e=this.getGeometries(),t=0;t<e.length;t++)if(!e[t].isLoaded())return!1;return!0},t.Le=function(t){var e=t.getUrl();t.te=this.ze[e]=H(e);var n=this.getRenderer();n?n.C(t):this.on("renderercreate",function(e){e.renderer.C(t)}),t.be(!0),t.fire("load",{data:t.te})},t.setStyle=function(e){return e?(this.Re=JSON.parse(JSON.stringify(e)),this.Ie()):delete this.Re,this},t.getStyle=function(){return this.Re&&this.Re.$root?this.Re.style:this.Re},t.updateSymbol=function(e,t){var n=this.getStyle();if(n){var i=n[e].symbol||{};for(var s in t)i[s]=t[s];this.Ie()}},t.Ie=function(){this.Ne(this.Re);var e=this.Re.$root?this.Re.style:this.Re;this.Be=function e(t){if(!Array.isArray(t))return e([t]);for(var n,i=[],s=0;s<t.length;s++){var r=void 0;r=!0===t[s].filter?function(){return!0}:(n=t[s].filter,new Function("f","var p = (f && f.properties || {}); return "+C(n))),i.push(F({},t[s],{filter:r}))}return i}(e),this.getGeometries().forEach(function(e){this.je(e)},this)},t.getGLTFUrls=function(){return Object.keys(this.requests)},t.Se=function(e){var t=this,n=c.Util.isString(e)?e.split(/\s+/).map(function(e){return"mouseleave"===e||"mouseenter"===e||"mouseout"===e?"mousemove":e}):e,i=this.mapEvents,s=u(n,K).filter(function(e){return t.mapEvents.indexOf(e)<0});this.mapEvents+=" "+s.join(" "),this.mapEvents=this.mapEvents.trim();var r=this.getMap();r&&(r.off(i,this.Fe,this),r.on(this.mapEvents,this.Fe,this))},t.Ae=function(){for(var e={},t=this.mapEvents,n=this.getGeometries(),i=0;i<n.length;i++)for(var s=n[i].getListeningEvents().map(function(e){return"mouseleave"===e||"mouseenter"===e||"mouseout"===e?"mousemove":e}),r=0;r<s.length;r++)e[s[r]]=1;this.mapEvents=u(Object.keys(e),K).join(" ");var a=this.getMap();a&&(a.off(t,this.Fe,this),a.on(this.mapEvents,this.Fe,this))},t.Ne=function(n){if(c.Util.isString(n.$root)){var i=/\{*(\$root)*\}/g;n.style.forEach(function(e){var t=e.symbol.url;t&&-1<t.indexOf("{$root}")&&(e.symbol.url=t.replace(i,n.$root))})}},t.je=function(i){var s=this;if(!this.Be)return!1;for(var r=0,e=this.Be.length;r<e;r++)if(!0===this.Be[r].filter({properties:i.getProperties()})){var t=function(){var e=s.Be[r].symbol,t=e.url,n=i.getUrl();return i.ie("url",t),t&&t!==n?s.re(i).then(function(){s.ae(n),i.ge(e)}):i.ge(e),{v:!0}}();if("object"==typeof t)return t.v}return!1},t.removeMarker=function(e){var t=this;if(Array.isArray(e))e.forEach(function(e){t.removeMarker(e)});else{var n=c.Util.isString(e)?this.Oe[e].A():e.A();i.prototype.removeGeometry.call(this,this.qe[n]),this.ue(e),this.Ae()}},t.getMapEvents=function(){return this.mapEvents},t.ue=function(e){var t=e.getUrl(),n=c.Util.isString(e)?this.Oe[e].A():e.A();this.requests[t]&&(this.requests[t].count-=1),this.requests[t]&&this.requests[t].count<=0&&delete this.requests[t];var i=this.getRenderer();i&&i.D(n),delete this.qe[n],delete this.Oe[e]},t.ae=function(e){if(this.requests[e]){this.requests[e].count-=1,this.requests[e].count<=0&&(delete this.requests[e],delete this.ze[e]);var t=this.getRenderer();t&&t.V(e)}},t.clear=function(){var e=this.getRenderer();return e&&e.G(),this.qe={},i.prototype.clear.call(this),this.requests={},this.Oe={},this},t.getRequests=function(){return this.requests},t.r=function(){return this.qe},t.W=function(e,t,n){var i=this.getRenderer();return i?i.W(e,t,n):null},t.Fe=function(e){if(this.options.markerEvents){var t=this.getMap();if(t){this.De=this.Je,this.Ge=this.Ve,this.We=this.$e,this.Ue=this.Xe;var n=t.coordinateToContainerPoint(e.coordinate,t.getGLZoom()),i=Math.round(n.x),s=Math.round(n.y);if(i<=0||i>=t.width||s<=0||s>=t.height)return this.Je=null,this.$e=null,void(this.Ve=null);var r=this.W(i,s);if(r)if(this.Je=r.target?r.target.A():null,this.$e=r.meshId,this.Ve=JSON.stringify(r.point),this.Xe=r.pickingId,"mousemove"===e.type)this.Ze().forEach(function(e){e.target.fire(e.type,e),"mousemove"===e.type||"mouseenter"===e.type?e.target.le(!0):e.target.le(!1)});else r.target&&r.target.fire(e.type,{type:e.type,target:r.target,meshId:r.meshId,pickingId:r.pickingId,point:r.point})}}},t.Ze=function(){var e=[];return h(this.Je)&&!h(this.De)?e.push({type:"mouseenter",target:this.qe[this.Je],meshId:this.$e,pickingId:this.Xe,point:JSON.parse(this.Ve)}):!h(this.Je)&&h(this.De)?e.push({type:"mouseout",target:this.qe[this.De],meshId:this.We,pickingId:this.Ue,point:JSON.parse(this.Ge)},{type:"mouseleave",target:this.qe[this.De],meshId:this.We,pickingId:this.Ue,point:JSON.parse(this.Ge)}):h(this.Je)&&h(this.De)&&(this.Je===this.De?e.push({type:"mousemove",target:this.qe[this.Je],meshId:this.$e,pickingId:this.Xe,point:JSON.parse(this.Ve)}):e.push({type:"mouseenter",target:this.qe[this.Je],meshId:this.$e,pickingId:this.Xe,point:JSON.parse(this.Ve)},{type:"mouseout",target:this.qe[this.De],meshId:this.We,pickingId:this.Ue,point:JSON.parse(this.Ge)},{type:"mouseleave",target:this.qe[this.De],meshId:this.We,pickingId:this.Ue,point:JSON.parse(this.Ge)})),e},e}(c.OverlayLayer);Q.mergeOptions({renderer:"gl",doubleBuffer:!1,glOptions:null,markerEvents:!0,forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0});var Y=function(t){function a(){return t.apply(this,arguments)||this}o(a,t),a.registerShader=function(e,t,n,i,s){d[e]={name:e,type:t,config:n,uniforms:i,shaderTypings:s}},a.removeShader=function(e){delete d[e]},a.getShaders=function(){var e=[];for(var t in d)e.push({shader:t,uniforms:d[t].uniforms,shaderTypings:d[t].shaderTypings});return e},a.getShaderMap=function(){return d},a.initDefaultShader=function(){var e={phongStudioTypings:{structure:{name:"phong",groups:[{name:"highLight",children:[{name:"lightAmbient"},{name:"lightDiffuse"},{name:"lightSpecular"}]},{name:"diffuse",children:[{name:"ambientStrength"},{name:"specularStrength"},{name:"materialShininess"}]},{name:"opacity",children:[{name:"opacity"}]}]},typing:{name:"phong",presets:[{name:"default",value:{lightAmbient:[0,0,0],lightDiffuse:[.5,.5,.5],lightSpecular:[.1,.7,.3],specularStrength:.8,ambientStrength:.5,materialShininess:32,opacity:1}},{name:"highLight",value:{lightPosition:[1,1,1],lightAmbient:[.7,1,1],lightDiffuse:[.2,.1,.9],lightSpecular:[.5,.3,.7],specularStrength:.7,ambientStrength:.8,materialShininess:64,opacity:.5}}],properties:{lightAmbient:{type:"color",name:"lightAmbient",value:[1,1,1]},lightDiffuse:{type:"color",name:"lightDiffuse",value:[.5,.5,.5]},lightSpecular:{type:"color",name:"lightSpecular",value:[.1,.7,.3]},ambientStrength:{type:"range",name:"ambientStrength",options:[.1,1,.1],value:.5},specularStrength:{type:"range",name:"specularStrength",options:[.1,1,.1],value:.8},materialShininess:{type:"range",name:"materialShininess",options:[1,64,1],value:32},opacity:{type:"range",name:"opacity",options:[0,1,.01],value:1}}}},wireframeStudioTypings:{structure:{name:"wireframe",groups:[{name:"color",children:[{name:"fill"},{name:"stroke"}]},{name:"dash",children:[{name:"dashEnabled"},{name:"dashAnimate"},{name:"dashOverlap"},{name:"dashRepeats"},{name:"dashLength"}]},{name:"squeeze",children:[{name:"seeThrough"},{name:"insideAltColor"},{name:"dualStroke"},{name:"squeezeMin"},{name:"squeezeMax"}]},{name:"opacity",children:[{name:"alpha"}]}]},typing:{name:"wireframe",presets:[{name:"Sleek",value:{seeThrough:!0,thickness:.01,fill:[.7725,.7725,.7725,1],stroke:[.1255,.1255,.1255,1],dashEnabled:!0,dashAnimate:!1,dashRepeats:9,dashLength:.7,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:.1,squeezeMax:1,dualStroke:!1,secondThickness:.05}},{name:"FunkyTorus",value:{seeThrough:!1,thickness:.02,fill:[.0549,.1411,.1882,1],stroke:[.9882,.2274,.3176,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:1,dashLength:.8,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:0,squeezeMax:1,dualStroke:!0,secondThickness:.05}},{name:"BlockyFade",value:{seeThrough:!0,thickness:.01,fill:[.698,.8353,.7294,1],stroke:[.3803,.6784,.6274,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:1,dashLength:.9,dashOverlap:!0,noiseA:!0,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:.1,squeezeMax:1,dualStroke:!1,secondThickness:.05}},{name:"SimpleWire",value:{seeThrough:!0,thickness:.03,fill:[.8235,.8235,.8235,1],stroke:[.698,.2274,.9333,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:1,dashLength:.8,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!1,squeeze:!1,squeezeMin:.5,squeezeMax:1,dualStroke:!1,secondThickness:.05}},{name:"NicerWire",value:{seeThrough:!0,thickness:.03,fill:[.9019,.9019,.9019,1],stroke:[.145,.145,.145,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:1,dashLength:.8,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:.4,squeezeMax:1,dualStroke:!1,secondThickness:.05}},{name:"Animated",value:{seeThrough:!1,thickness:.02,fill:[.7764,.8392,.7215,1],stroke:[.596,.498,.4117,1],dashEnabled:!0,dashAnimate:!0,dashRepeats:6,dashLength:.6,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!1,squeeze:!0,squeezeMin:.2,squeezeMax:1,dualStroke:!1,secondThickness:.03}},{name:"FunZone",value:{seeThrough:!0,thickness:.02,fill:[.1058,.6901,.8078,1],stroke:[.3098,.5255,.6,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:2,dashLength:.7,dashOverlap:!0,noiseA:!0,noiseB:!0,insideAltColor:!0,squeeze:!0,squeezeMin:.2,squeezeMax:1,dualStroke:!1,secondThickness:.03}},{name:"Dotted",value:{seeThrough:!0,thickness:.04,fill:[.8117,.498,.3686,1],stroke:[.5765,.2,.2,1],dashEnabled:!0,dashAnimate:!1,dashRepeats:8,dashLength:.5,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:.2,squeezeMax:1,dualStroke:!1,secondThickness:.05}},{name:"Flower",value:{seeThrough:!0,thickness:.09,fill:[.8392,.8823,.7804,1],stroke:[.5804,.7804,.7137,1],dashEnabled:!0,dashAnimate:!1,dashRepeats:1,dashLength:.8,dashOverlap:!1,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:.2,squeezeMax:0,dualStroke:!1,secondThickness:.05}},{name:"Tapered",value:{seeThrough:!1,thickness:.015,fill:[.898,.8666,.7961,1],stroke:[.9215,.4823,.349,1],dashEnabled:!0,dashAnimate:!1,dashRepeats:1,dashLength:.6,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:0,squeezeMax:.64,dualStroke:!1,secondThickness:.03}}],properties:{time:{name:"time",type:"range",value:0},seeThrough:{name:"seeThrough",type:"switch",value:!0},fill:{name:"fill",type:"color",value:[1,.5137,.98,1]},stroke:{name:"stroke",type:"color",value:[.7019,.9333,.2274,1]},dashEnabled:{name:"dashEnabled",type:"switch",value:!1},dashAnimate:{name:"dashAnimate",type:"switch",value:!1},dashOverlap:{name:"dashOverlap",type:"switch",value:!0},dashRepeats:{name:"dashRepeats",type:"range",options:[0,10,1],value:1},dashLength:{name:"dashLength",type:"range",options:[0,10,.1],value:.8},thickness:{name:"thickness",type:"range",options:[.01,1,.01],value:.03},secondThickness:{name:"secondThickness",type:"range",options:[.01,1,.01],value:.05},insideAltColor:{name:"insideAltColor",type:"switch",value:!1},squeeze:{name:"squeeze",type:"switch",value:!1},dualStroke:{name:"dualStroke",type:"switch",value:!1},squeezeMin:{name:"squeezeMin",type:"range",options:[.1,1,.1],value:.5},squeezeMax:{name:"squeezeMax",type:"range",options:[.1,1,.1],value:1},opacity:{type:"range",name:"opacity",options:[0,1,.01],value:1}}}},effectStudioTypings:{structure:{name:"effect",groups:[]},typing:{name:"effect",presets:[]},properties:{}},pbrStudioTypings:{structure:{name:"pbr",groups:[]},typing:{name:"pbr",presets:[]},properties:{}},glowmarkerStudioTypings:{structure:{name:"glowmarker",groups:[]},typing:{name:"glowmarker",presets:[]},properties:{}}},t={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL"},material:new l.reshader.PhongMaterial};a.registerShader("phong","PhongShader",t.shader,t.material.getUniforms(),e.phongStudioTypings);var n={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL",extraCommandProps:{cull:{enable:!1,face:"back"},frontFace:"cw"}},material:new l.reshader.WireFrameMaterial};a.registerShader("wireframe","WireframeShader",n.shader,n.material.getUniforms(),e.wireframeStudioTypings);var i={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL",tangentAttribute:"TANGENT",colorAttribute:"COLOR_0",uv0Attribute:"TEXCOORD_0",uv1Attribute:"TEXCOORD_1",extraCommandProps:{cull:{enable:!0},frontFace:"ccw"},defines:{HAS_IBL_LIGHTING:1}},material:new l.reshader.pbr.StandardMaterial({})};a.registerShader("pbr","pbr.StandardShader",i.shader,i.material.getUniforms(),e.pbrStudioTypings)},a.fromJSON=function(e){if(!e||"GLTFLayer"!==e.type)return null;for(var t=new a(e.id,e.options),n=e.geometries,i=[],s=0;s<n.length;s++){var r=_.fromJSON(n[s]);r&&i.push(r)}return t.addMarker(i),e.style&&t.setStyle(e.style),t};var e=a.prototype;return e.onAdd=function(){this.getMap().on(this.mapEvents,this.Fe,this),t.prototype.onAdd.call(this)},e.remove=function(){var e=this.getMap();e&&(e.off(this.mapEvents,this.Fe),t.prototype.remove.call(this))},e.identify=function(e,t){var n=this.getMap(),i=n.coordinateToContainerPoint(e,n.getGLZoom()),s=Math.round(i.x),r=Math.round(i.y);return this.W(s,r,t)},e.He=function(){var t=this,e=this.getRenderer();e?this.Ke(e.gltfScenes):this.on("renderercreate",function(e){t.Ke(e.renderer.gltfScenes)})},e.Ke=function(e){for(var t in this.pickingId=0,this.qe){var n=this.qe[t],i=e[t],s=n.A();delete this.qe[s],delete e[s],n.Me(this.pickingId),this.qe[this.pickingId]=n,e[this.pickingId]=i;var r=n.getCount();this.pickingId+=r}},e.f=function(e){var t=this.getRenderer();t&&t.f(e)},a}(Q);Y.initDefaultShader(),Y.mergeOptions({marekrTypes:["gltfmarker","groupgltfmarker"]}),Y.registerJSONType("GLTFLayer"),Y.registerRenderer("gl",n);var ee=[1,1,1,1],te=[],ne=[],ie=function(i){function t(e,t){var n;return(n=i.call(this,null,t)||this).Qe=e,n.Ye=[],n.Z="groupgltfmarker",n}o(t,i),t.fromJSON=function(e){return new t(e.data,e.options)};var e=t.prototype;return e.setCoordinates=function(e){return Array.isArray(e[0])?this.et=e.map(function(e){return new c.Coordinate(e)}):this.et=e,this.updateAllData("coordinates",this.et),this.H=!0,this},e.addData=function(e){this.Qe.push(e);var t=this.getLayer();return t&&t.He(),this.H=!0,this},e.removeData=function(e){return this.Qe.splice(e,1),this.O&&this.Ye.splice(e,1),this.H=!0,this},e.getData=function(e){return this.Qe[e]},e.updateData=function(e,t,n){return this.Qe[e][t]=n,this.H=!0,this},e.updateAllData=function(e,t){for(var n=0;n<this.Qe.length;n++)this.updateData(n,e,t[n]);return this},e.O=function(){if(this.Qe){this.Ye=this.Ye||[];for(var e=0;e<this.Qe.length;e++){var t=this.tt(e);this.Ye[e]=t}}},e.tt=function(e){var t=this.Qe[e],n=this.fe(t.coordinates),i=l.vec3.add(te,t.translation||this.K.translation,n||this.K.translation),s=t.rotation||this.K.rotation,r=t.scale||this.K.scale,a=l.quat.fromEuler(ne,s[0]||0,s[1]||0,s[2]||0);return l.mat4.fromRotationTranslationScale(this.Ye[e]||[],a,i,r)},e.B=function(){i.prototype.B.call(this),this.O()},e.nt=function(){this.it&&this.it.instance_vectorA.length/4===this.Ye.length||(this.it={instance_vectorA:[],instance_vectorB:[],instance_vectorC:[],instance_vectorD:[],instance_color:[],aPickingId:[]});for(var e=0;e<this.Ye.length;e++){var t=this.Ye[e];this.st("instance_vectorA",e,0,4,t),this.st("instance_vectorB",e,1,4,t),this.st("instance_vectorC",e,2,4,t),this.st("instance_vectorD",e,3,4,t),this.st("instance_color",e,0,1,this.Qe[e].color||ee),this.it.aPickingId[e]=this.A()+e}return this.it},e.st=function(e,t,n,i,s){this.it[e][4*t]=s[n*i],this.it[e][4*t+1]=s[n*i+1],this.it[e][4*t+2]=s[n*i+2],this.it[e][4*t+3]=s[n*i+3]},e._=function(e){return this.H?this.nt(e):this.it},e.getCount=function(){return this.Qe.length},e.toJSON=function(){return JSON.parse(JSON.stringify({data:this.Qe,options:this.options}))},e.getIndexByPickingId=function(e){return e-this.A()},t}(_),se=function(i){function t(e,t){var n;return(n=i.call(this,e,t)||this).Z="effectmarker",n}o(t,i),t.fromJSON=function(e){return new t(e.coordinates,e.options)};var e=t.prototype;return e.on=function(){},e.off=function(){},e.isAnimated=function(){var e=this.oe();return e&&e.animation},e.getShader=function(){return"effect"},e.setTransparent=function(e){return this.options.symbol.transparent=e,this},e.isTransparent=function(){return this.options.symbol.transparent},e.updateUV=function(e){var t,n=this.isLooped(),i=this.getAnimationSpeed()||1,s=this.getUniforms(),r=s.width,a=s.height,o=this.getEffectType();"uv"===o?t=n?.01*e*i%(r*a):.01*e:"sequence"===o&&(t=n?Math.floor(.01*e*i)%(r*a):Math.floor(.01*e));var h=Number(t%r),u=Math.floor(t/r);this.setUniform("uvOffset",[h,u])},e.getEffectType=function(){return this.oe().effect||"uv"},e.setEffectType=function(e){return this.oe().effect=e,this},t}(_);se.mergeOptions({visible:!0});var re=function(e){function s(){return e.apply(this,arguments)||this}return o(s,e),s.registerShader=function(e,t,n,i,s){d[e]={name:e,type:t,config:n,uniforms:i,shaderTypings:s}},s.initDefaultShader=function(){var e,t,n={phongStudioTypings:{structure:{name:"phong",groups:[{name:"highLight",children:[{name:"lightAmbient"},{name:"lightDiffuse"},{name:"lightSpecular"}]},{name:"diffuse",children:[{name:"ambientStrength"},{name:"specularStrength"},{name:"materialShininess"}]},{name:"opacity",children:[{name:"opacity"}]}]},typing:{name:"phong",presets:[{name:"default",value:{lightAmbient:[0,0,0],lightDiffuse:[.5,.5,.5],lightSpecular:[.1,.7,.3],specularStrength:.8,ambientStrength:.5,materialShininess:32,opacity:1}},{name:"highLight",value:{lightPosition:[1,1,1],lightAmbient:[.7,1,1],lightDiffuse:[.2,.1,.9],lightSpecular:[.5,.3,.7],specularStrength:.7,ambientStrength:.8,materialShininess:64,opacity:.5}}],properties:{lightAmbient:{type:"color",name:"lightAmbient",value:[1,1,1]},lightDiffuse:{type:"color",name:"lightDiffuse",value:[.5,.5,.5]},lightSpecular:{type:"color",name:"lightSpecular",value:[.1,.7,.3]},ambientStrength:{type:"range",name:"ambientStrength",options:[.1,1,.1],value:.5},specularStrength:{type:"range",name:"specularStrength",options:[.1,1,.1],value:.8},materialShininess:{type:"range",name:"materialShininess",options:[1,64,1],value:32},opacity:{type:"range",name:"opacity",options:[0,1,.01],value:1}}}},wireframeStudioTypings:{structure:{name:"wireframe",groups:[{name:"color",children:[{name:"fill"},{name:"stroke"}]},{name:"dash",children:[{name:"dashEnabled"},{name:"dashAnimate"},{name:"dashOverlap"},{name:"dashRepeats"},{name:"dashLength"}]},{name:"squeeze",children:[{name:"seeThrough"},{name:"insideAltColor"},{name:"dualStroke"},{name:"squeezeMin"},{name:"squeezeMax"}]},{name:"opacity",children:[{name:"alpha"}]}]},typing:{name:"wireframe",presets:[{name:"Sleek",value:{seeThrough:!0,thickness:.01,fill:[.7725,.7725,.7725,1],stroke:[.1255,.1255,.1255,1],dashEnabled:!0,dashAnimate:!1,dashRepeats:9,dashLength:.7,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:.1,squeezeMax:1,dualStroke:!1,secondThickness:.05}},{name:"FunkyTorus",value:{seeThrough:!1,thickness:.02,fill:[.0549,.1411,.1882,1],stroke:[.9882,.2274,.3176,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:1,dashLength:.8,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:0,squeezeMax:1,dualStroke:!0,secondThickness:.05}},{name:"BlockyFade",value:{seeThrough:!0,thickness:.01,fill:[.698,.8353,.7294,1],stroke:[.3803,.6784,.6274,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:1,dashLength:.9,dashOverlap:!0,noiseA:!0,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:.1,squeezeMax:1,dualStroke:!1,secondThickness:.05}},{name:"SimpleWire",value:{seeThrough:!0,thickness:.03,fill:[.8235,.8235,.8235,1],stroke:[.698,.2274,.9333,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:1,dashLength:.8,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!1,squeeze:!1,squeezeMin:.5,squeezeMax:1,dualStroke:!1,secondThickness:.05}},{name:"NicerWire",value:{seeThrough:!0,thickness:.03,fill:[.9019,.9019,.9019,1],stroke:[.145,.145,.145,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:1,dashLength:.8,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:.4,squeezeMax:1,dualStroke:!1,secondThickness:.05}},{name:"Animated",value:{seeThrough:!1,thickness:.02,fill:[.7764,.8392,.7215,1],stroke:[.596,.498,.4117,1],dashEnabled:!0,dashAnimate:!0,dashRepeats:6,dashLength:.6,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!1,squeeze:!0,squeezeMin:.2,squeezeMax:1,dualStroke:!1,secondThickness:.03}},{name:"FunZone",value:{seeThrough:!0,thickness:.02,fill:[.1058,.6901,.8078,1],stroke:[.3098,.5255,.6,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:2,dashLength:.7,dashOverlap:!0,noiseA:!0,noiseB:!0,insideAltColor:!0,squeeze:!0,squeezeMin:.2,squeezeMax:1,dualStroke:!1,secondThickness:.03}},{name:"Dotted",value:{seeThrough:!0,thickness:.04,fill:[.8117,.498,.3686,1],stroke:[.5765,.2,.2,1],dashEnabled:!0,dashAnimate:!1,dashRepeats:8,dashLength:.5,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:.2,squeezeMax:1,dualStroke:!1,secondThickness:.05}},{name:"Flower",value:{seeThrough:!0,thickness:.09,fill:[.8392,.8823,.7804,1],stroke:[.5804,.7804,.7137,1],dashEnabled:!0,dashAnimate:!1,dashRepeats:1,dashLength:.8,dashOverlap:!1,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:.2,squeezeMax:0,dualStroke:!1,secondThickness:.05}},{name:"Tapered",value:{seeThrough:!1,thickness:.015,fill:[.898,.8666,.7961,1],stroke:[.9215,.4823,.349,1],dashEnabled:!0,dashAnimate:!1,dashRepeats:1,dashLength:.6,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:0,squeezeMax:.64,dualStroke:!1,secondThickness:.03}}],properties:{time:{name:"time",type:"range",value:0},seeThrough:{name:"seeThrough",type:"switch",value:!0},fill:{name:"fill",type:"color",value:[1,.5137,.98,1]},stroke:{name:"stroke",type:"color",value:[.7019,.9333,.2274,1]},dashEnabled:{name:"dashEnabled",type:"switch",value:!1},dashAnimate:{name:"dashAnimate",type:"switch",value:!1},dashOverlap:{name:"dashOverlap",type:"switch",value:!0},dashRepeats:{name:"dashRepeats",type:"range",options:[0,10,1],value:1},dashLength:{name:"dashLength",type:"range",options:[0,10,.1],value:.8},thickness:{name:"thickness",type:"range",options:[.01,1,.01],value:.03},secondThickness:{name:"secondThickness",type:"range",options:[.01,1,.01],value:.05},insideAltColor:{name:"insideAltColor",type:"switch",value:!1},squeeze:{name:"squeeze",type:"switch",value:!1},dualStroke:{name:"dualStroke",type:"switch",value:!1},squeezeMin:{name:"squeezeMin",type:"range",options:[.1,1,.1],value:.5},squeezeMax:{name:"squeezeMax",type:"range",options:[.1,1,.1],value:1},opacity:{type:"range",name:"opacity",options:[0,1,.01],value:1}}}},effectStudioTypings:{structure:{name:"effect",groups:[]},typing:{name:"effect",presets:[]},properties:{}},pbrStudioTypings:{structure:{name:"pbr",groups:[]},typing:{name:"pbr",presets:[]},properties:{}},glowmarkerStudioTypings:{structure:{name:"glowmarker",groups:[]},typing:{name:"glowmarker",presets:[]},properties:{}}},i=(e={vert:"\n        attribute vec3 aPosition;\n        attribute vec2 aTexCoord;\n        uniform mat4 projViewMatrix;\n        uniform mat4 modelMatrix;\n        uniform vec2 uvOffset;\n        uniform float width;\n        uniform float height;\n        varying vec2 vTexCoords;\n        void main()\n        {\n            gl_Position = projViewMatrix * modelMatrix * vec4(aPosition, 1.0);\n            vTexCoords = (uvOffset + aTexCoord) * vec2(1.0 / width, 1.0 / height);\n        }\n    ",frag:"\n        precision mediump float;\n        uniform sampler2D texture;\n\n        varying vec2 vTexCoords;\n        void main() {\n            vec4 color = texture2D(texture, vTexCoords);\n            gl_FragColor = vec4(color.rgb, color.a) * color.a;\n        }\n    ",uniforms:["texture","uvOffset","width","height","projViewMatrix"],positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}},t=new l.reshader.Material,{shader:e,material:t});s.registerShader("effect","MeshShader",i.shader,i.material.getUniforms(),n.effectStudioTypings)},s}(Q);re.initDefaultShader(),re.mergeOptions({marekrTypes:["effectmarker"]}),re.registerJSONType("EffectLayer"),re.registerRenderer("gl",n);var ae=function(i){function t(e,t){var n;return(n=i.call(this,e,t)||this).Z="glowmarker",n}o(t,i),t.fromJSON=function(e){return new t(e.coordinates,e.options)};var e=t.prototype;return e.getUrl=function(){return"plane"},e.setSpeed=function(e){this.setUniform("speed",e)},e.getSpeed=function(){return this.oe().uniforms.speed},e.getShader=function(){return"glowmarker"},e.isAnimated=function(){var e=this.oe();return e&&e.animation},e.L=function(){var e=this.oe();e.uniforms.time=e.uniforms.time||0,e.uniforms.time+=.01},t}(_);ae.mergeOptions({visible:!0});var oe=function(e){function s(){return e.apply(this,arguments)||this}return o(s,e),s.registerShader=function(e,t,n,i,s){d[e]={name:e,type:t,config:n,uniforms:i,shaderTypings:s}},s.initDefaultShader=function(){var e,t,n={phongStudioTypings:{structure:{name:"phong",groups:[{name:"highLight",children:[{name:"lightAmbient"},{name:"lightDiffuse"},{name:"lightSpecular"}]},{name:"diffuse",children:[{name:"ambientStrength"},{name:"specularStrength"},{name:"materialShininess"}]},{name:"opacity",children:[{name:"opacity"}]}]},typing:{name:"phong",presets:[{name:"default",value:{lightAmbient:[0,0,0],lightDiffuse:[.5,.5,.5],lightSpecular:[.1,.7,.3],specularStrength:.8,ambientStrength:.5,materialShininess:32,opacity:1}},{name:"highLight",value:{lightPosition:[1,1,1],lightAmbient:[.7,1,1],lightDiffuse:[.2,.1,.9],lightSpecular:[.5,.3,.7],specularStrength:.7,ambientStrength:.8,materialShininess:64,opacity:.5}}],properties:{lightAmbient:{type:"color",name:"lightAmbient",value:[1,1,1]},lightDiffuse:{type:"color",name:"lightDiffuse",value:[.5,.5,.5]},lightSpecular:{type:"color",name:"lightSpecular",value:[.1,.7,.3]},ambientStrength:{type:"range",name:"ambientStrength",options:[.1,1,.1],value:.5},specularStrength:{type:"range",name:"specularStrength",options:[.1,1,.1],value:.8},materialShininess:{type:"range",name:"materialShininess",options:[1,64,1],value:32},opacity:{type:"range",name:"opacity",options:[0,1,.01],value:1}}}},wireframeStudioTypings:{structure:{name:"wireframe",groups:[{name:"color",children:[{name:"fill"},{name:"stroke"}]},{name:"dash",children:[{name:"dashEnabled"},{name:"dashAnimate"},{name:"dashOverlap"},{name:"dashRepeats"},{name:"dashLength"}]},{name:"squeeze",children:[{name:"seeThrough"},{name:"insideAltColor"},{name:"dualStroke"},{name:"squeezeMin"},{name:"squeezeMax"}]},{name:"opacity",children:[{name:"alpha"}]}]},typing:{name:"wireframe",presets:[{name:"Sleek",value:{seeThrough:!0,thickness:.01,fill:[.7725,.7725,.7725,1],stroke:[.1255,.1255,.1255,1],dashEnabled:!0,dashAnimate:!1,dashRepeats:9,dashLength:.7,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:.1,squeezeMax:1,dualStroke:!1,secondThickness:.05}},{name:"FunkyTorus",value:{seeThrough:!1,thickness:.02,fill:[.0549,.1411,.1882,1],stroke:[.9882,.2274,.3176,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:1,dashLength:.8,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:0,squeezeMax:1,dualStroke:!0,secondThickness:.05}},{name:"BlockyFade",value:{seeThrough:!0,thickness:.01,fill:[.698,.8353,.7294,1],stroke:[.3803,.6784,.6274,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:1,dashLength:.9,dashOverlap:!0,noiseA:!0,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:.1,squeezeMax:1,dualStroke:!1,secondThickness:.05}},{name:"SimpleWire",value:{seeThrough:!0,thickness:.03,fill:[.8235,.8235,.8235,1],stroke:[.698,.2274,.9333,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:1,dashLength:.8,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!1,squeeze:!1,squeezeMin:.5,squeezeMax:1,dualStroke:!1,secondThickness:.05}},{name:"NicerWire",value:{seeThrough:!0,thickness:.03,fill:[.9019,.9019,.9019,1],stroke:[.145,.145,.145,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:1,dashLength:.8,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:.4,squeezeMax:1,dualStroke:!1,secondThickness:.05}},{name:"Animated",value:{seeThrough:!1,thickness:.02,fill:[.7764,.8392,.7215,1],stroke:[.596,.498,.4117,1],dashEnabled:!0,dashAnimate:!0,dashRepeats:6,dashLength:.6,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!1,squeeze:!0,squeezeMin:.2,squeezeMax:1,dualStroke:!1,secondThickness:.03}},{name:"FunZone",value:{seeThrough:!0,thickness:.02,fill:[.1058,.6901,.8078,1],stroke:[.3098,.5255,.6,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:2,dashLength:.7,dashOverlap:!0,noiseA:!0,noiseB:!0,insideAltColor:!0,squeeze:!0,squeezeMin:.2,squeezeMax:1,dualStroke:!1,secondThickness:.03}},{name:"Dotted",value:{seeThrough:!0,thickness:.04,fill:[.8117,.498,.3686,1],stroke:[.5765,.2,.2,1],dashEnabled:!0,dashAnimate:!1,dashRepeats:8,dashLength:.5,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:.2,squeezeMax:1,dualStroke:!1,secondThickness:.05}},{name:"Flower",value:{seeThrough:!0,thickness:.09,fill:[.8392,.8823,.7804,1],stroke:[.5804,.7804,.7137,1],dashEnabled:!0,dashAnimate:!1,dashRepeats:1,dashLength:.8,dashOverlap:!1,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:.2,squeezeMax:0,dualStroke:!1,secondThickness:.05}},{name:"Tapered",value:{seeThrough:!1,thickness:.015,fill:[.898,.8666,.7961,1],stroke:[.9215,.4823,.349,1],dashEnabled:!0,dashAnimate:!1,dashRepeats:1,dashLength:.6,dashOverlap:!0,noiseA:!1,noiseB:!1,insideAltColor:!0,squeeze:!0,squeezeMin:0,squeezeMax:.64,dualStroke:!1,secondThickness:.03}}],properties:{time:{name:"time",type:"range",value:0},seeThrough:{name:"seeThrough",type:"switch",value:!0},fill:{name:"fill",type:"color",value:[1,.5137,.98,1]},stroke:{name:"stroke",type:"color",value:[.7019,.9333,.2274,1]},dashEnabled:{name:"dashEnabled",type:"switch",value:!1},dashAnimate:{name:"dashAnimate",type:"switch",value:!1},dashOverlap:{name:"dashOverlap",type:"switch",value:!0},dashRepeats:{name:"dashRepeats",type:"range",options:[0,10,1],value:1},dashLength:{name:"dashLength",type:"range",options:[0,10,.1],value:.8},thickness:{name:"thickness",type:"range",options:[.01,1,.01],value:.03},secondThickness:{name:"secondThickness",type:"range",options:[.01,1,.01],value:.05},insideAltColor:{name:"insideAltColor",type:"switch",value:!1},squeeze:{name:"squeeze",type:"switch",value:!1},dualStroke:{name:"dualStroke",type:"switch",value:!1},squeezeMin:{name:"squeezeMin",type:"range",options:[.1,1,.1],value:.5},squeezeMax:{name:"squeezeMax",type:"range",options:[.1,1,.1],value:1},opacity:{type:"range",name:"opacity",options:[0,1,.01],value:1}}}},effectStudioTypings:{structure:{name:"effect",groups:[]},typing:{name:"effect",presets:[]},properties:{}},pbrStudioTypings:{structure:{name:"pbr",groups:[]},typing:{name:"pbr",presets:[]},properties:{}},glowmarkerStudioTypings:{structure:{name:"glowmarker",groups:[]},typing:{name:"glowmarker",presets:[]},properties:{}}},i=(e={vert:"\n        #ifdef GL_ES\n            precision highp float;\n        #endif\n        attribute vec3 aPosition;\n        uniform mat4 projViewModelMatrix;\n        uniform mat4 modelMatrix;\n        varying vec3 v_FragPos; \n        varying vec3 v_center;\n        void main(){\n            gl_Position=projViewModelMatrix*vec4(aPosition,1.);\n            vec4 worldPos = modelMatrix * vec4(aPosition, 1.0);\n            v_FragPos = worldPos.xyz;\n            v_center = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;\n        }\n    ",frag:"\n        #ifdef GL_ES\n            precision highp float;\n        #endif\n        #define pi 3.14159\n        const float dotsnb = 30.0; // Number of dots\n        \n        varying vec3 v_FragPos;\n        varying vec3 v_center;\n        uniform float time;\n        uniform float radius;\n        uniform vec3 color;\n        uniform float speed;\n        vec3 hsb2rgb(in vec3 c)\n        {\n            vec3 rgb = clamp(abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),6.0)-3.0)-1.0,0.0,1.0 );\n            rgb = rgb*rgb*(4.0-2.0*rgb);\n            return c.z * mix( vec3(1.0), rgb, c.y);\n        }\n        \n        void main()\n        {\n            float r = length(v_FragPos - v_center);\n            r = r*2.-1.;\n            if(r>radius) {\n                gl_FragColor = vec4(1.0,1.0,1.0, 0.0);\n            } else {\n                //vec3 color = hsb2rgb(vec3(fract(time*.1),.7,.4));\n                vec3 color = color;\n                float s = abs(sin(pow(r+5.0, 1.5)-time*speed+sin(r*0.9))*sin(r+.99));\n                color *= (abs(1./(s*10.8))-.01);\n                gl_FragColor = vec4(color, (color.x + color.y + color.z) / 1.0);\n            }\n        }\n    ",uniforms:["time","radius","color","speed",{name:"projViewModelMatrix",type:"function",fn:function(e,t){return l.mat4.multiply([],t.projViewMatrix,t.modelMatrix)}}],positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one",dstAlpha:1},equation:{rgb:"add",alpha:"add"},color:[0,0,0,0]}}},t=new l.reshader.Material,{shader:e,material:t});s.registerShader("glowmarker","MeshShader",i.shader,i.material.getUniforms(),n.glowmarkerStudioTypings)},s}(Q);oe.initDefaultShader(),oe.mergeOptions({marekrTypes:["glowmarker"]}),oe.registerJSONType("GlowMarkerLayer"),oe.registerRenderer("gl",n),e.GLTFLayer=Y,e.GLTFMarker=_,e.GroupGLTFMarker=ie,e.EffectMarker=se,e.EffectLayer=re,e.GlowMarker=ae,e.GlowMarkerLayer=oe,Object.defineProperty(e,"rt",{value:!0}),"undefined"!=typeof console&&console.log("@maptalks/gltf-layer v0.2.0, requires maptalks@<2.0.0.")});
